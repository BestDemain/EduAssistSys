# AI报告生成器使用说明

## 功能概述

AI报告生成器是教育辅助可视分析系统的核心功能之一，它集成了智谱AI大模型，能够自动分析学习数据并生成专业的教育分析报告。

## 主要特性

### 1. 智能API配置
- 支持用户输入智谱AI API密钥
- 如果未输入，自动使用环境变量 `ZHIPUAI_API_KEY`
- 安全的密钥管理机制

### 2. 灵活的报告范围选择
- **单个学生**: 针对特定学生的个性化分析报告
- **多个学生对比**: 对比分析多个学生的学习表现
- **单个班级**: 整个班级的学习情况分析
- **多个班级对比**: 跨班级的对比分析
- **所有学生整体**: 全校学生的综合分析报告

### 3. 多维度数据分析
- **知识点掌握度分析**: 分析学生对各知识点的掌握情况
- **学习行为模式分析**: 分析学生的学习习惯和行为模式
- **题目难度分析**: 分析题目难度与学生表现的匹配度
- **掌握趋势分析**: 分析学生学习进步的时间趋势

### 4. AI驱动的报告生成
- 使用智谱AI GLM-4-Flash模型进行文本分析
- 支持GLM-4V-Flash多模态模型分析图表图像
- 智能的提示词工程，确保报告质量
- 自定义提示词支持，满足个性化需求

## 使用流程

### 步骤1: 配置设置
1. 打开报告生成器页面
2. 输入智谱AI API密钥（可选）
3. 选择报告范围（单个学生、多个学生等）
4. 根据选择的范围，选择具体的目标对象
5. 输入自定义提示词（可选）

### 步骤2: 选择分析类型
1. 从可用的分析类型中选择需要包含的分析
2. 系统会自动获取相应的分析数据
3. 支持多选，可以生成综合性报告

### 步骤3: 生成报告
1. 系统调用智谱AI API
2. 实时显示生成进度
3. 自动保存生成的报告到后端

### 步骤4: 查看和下载
1. 预览生成的报告内容
2. 支持下载为文本文件
3. 可以重新生成或修改配置

## 技术架构

### 前端组件 (ReportGenerator.js)
- 基于React和Ant Design构建
- 分步骤的用户界面设计
- 实时进度反馈
- 响应式布局支持

### 后端服务 (ai_report_service.py)
- 智谱AI SDK集成
- 文本和多模态模型支持
- 报告存储和管理
- 错误处理和日志记录

### API接口
- `POST /api/report/generate_ai`: 生成AI报告
- `GET /api/report/ai_history`: 获取报告历史
- `GET /api/report/ai/<report_id>`: 获取指定报告
- `DELETE /api/report/ai/<report_id>`: 删除报告
- `POST /api/report/download`: 下载报告

## 配置要求

### 环境变量
```bash
# 智谱AI API密钥
export ZHIPUAI_API_KEY="your_api_key_here"
```

### 依赖包
```bash
# 安装智谱AI SDK
pip install zhipuai==2.0.1
```

## 使用示例

### 1. 单个学生报告
```javascript
// 前端配置示例
const reportConfig = {
  scope: 'single_student',
  targets: ['20230001'],
  analysisTypes: ['knowledge', 'behavior'],
  customPrompt: '请重点分析该学生的数学学习情况'
};
```

### 2. 班级对比报告
```javascript
// 前端配置示例
const reportConfig = {
  scope: 'multiple_classes',
  targets: ['Class1', 'Class2'],
  analysisTypes: ['knowledge', 'difficulty'],
  customPrompt: '请对比两个班级的整体学习表现'
};
```

## 报告内容结构

生成的报告通常包含以下部分：

1. **执行摘要**: 关键发现和结论概述
2. **数据概览**: 分析数据的基本统计信息
3. **详细分析**: 根据选择的分析类型进行深入分析
4. **发现和洞察**: 从数据中提取的重要发现
5. **建议和改进措施**: 基于分析结果的具体建议
6. **结论**: 总结和展望

## 注意事项

1. **API密钥安全**: 请妥善保管智谱AI API密钥，避免泄露
2. **网络连接**: 确保服务器能够访问智谱AI API服务
3. **数据隐私**: 生成的报告包含学生数据，请注意数据保护
4. **成本控制**: AI模型调用会产生费用，请合理使用
5. **报告存储**: 生成的报告会保存在 `backend/reports` 目录中

## 故障排除

### 常见问题

1. **API密钥错误**
   - 检查环境变量设置
   - 验证API密钥的有效性

2. **网络连接失败**
   - 检查网络连接
   - 确认防火墙设置

3. **数据获取失败**
   - 检查后端数据服务是否正常
   - 验证选择的学生/班级是否存在

4. **报告生成超时**
   - 减少分析数据的复杂度
   - 检查API服务状态

### 日志查看

后端日志会记录详细的错误信息，可以通过以下方式查看：

```bash
# 查看Flask应用日志
tail -f backend/app.log

# 查看AI服务日志
tail -f backend/ai_service.log
```

## 更新日志

### v1.0.0 (2024-01-XX)
- 初始版本发布
- 支持智谱AI GLM-4-Flash文本模型
- 支持GLM-4V-Flash多模态模型
- 实现基础的报告生成功能
- 添加报告历史管理

## 联系支持

如果在使用过程中遇到问题，请联系开发团队或查看项目文档。